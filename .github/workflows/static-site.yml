name: Deploy static site

on:
  push:
    paths: 
      - 'site/**'
      - '**'

env: 
  PROJECT_ID: main-104
  SITE_HOSTNAME: www.gcp.qipeit.com
  REGION: us-central


jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1

    - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
      with:
        version: ‘274.0.0’
        service_account_key: ${{ secrets.SERVICE_ACCOUNT }}

#    - name: test
#      run: |
#        echo '\nshow exports:'
#        export
#        echo '\nshow env:'
#        env
#        echo 'current dir:'
#        pwd
#        ls -la
#        echo 'list root fs:'
#        ls -l /
#        hh=$(cat /etc/hostname)
#        echo $hh


    - name: Create storage bucket if not exists
      run: |
        echo gsutil mb -p ${PROJECT_ID} -l ${REGION} -c standard -b on gs://${SITE_HOSTNAME} || true
        gsutil mb -p ${PROJECT_ID} -l ${REGION} -c standard -b on gs://${SITE_HOSTNAME} || true
        #gsutil iam ch allUsers:objectViewer gs://${SITE_HOSTNAME}


